From 5ac70ba7f2b4d1c8edfd381fd92e774d0e156b8a Mon Sep 17 00:00:00 2001
From: Ilan Smith <ilan.smith@sandisk.com>
Date: Thu, 16 Jul 2015 00:04:09 +0300
Subject: [PATCH] Added dev_hierarchy attribute for tracing mmc devices
 hierarchy.

Change-Id: I4bb20649734443ae6f95e221487a9ae539c9c53f
---
 drivers/Makefile        | 3 +++
 drivers/mmc/core/mmc.c  | 2 ++
 include/linux/mmc/dev.h | 9 +++++++++
 3 files changed, 14 insertions(+)
 create mode 100644 include/linux/mmc/dev.h

diff --git a/drivers/Makefile b/drivers/Makefile
index 08b22e6..fddb44d 100644
--- a/drivers/Makefile
+++ b/drivers/Makefile
@@ -155,3 +155,6 @@ obj-$(CONFIG_LGE_FELICA)        += felica/
 
 obj-$(CONFIG_BIF)		+= bif/
 obj-$(CONFIG_SENSORS)		+= sensors/
+
+obj-y				+= $(MMC_MH_PANIC_DEV_HIERARCHY_PATH)
+
diff --git a/drivers/mmc/core/mmc.c b/drivers/mmc/core/mmc.c
index 0c6969f..3e6f774 100644
--- a/drivers/mmc/core/mmc.c
+++ b/drivers/mmc/core/mmc.c
@@ -17,6 +17,7 @@
 #include <linux/mmc/host.h>
 #include <linux/mmc/card.h>
 #include <linux/mmc/mmc.h>
+#include <linux/mmc/dev.h>
 #include <linux/pm_runtime.h>
 #include <linux/reboot.h>
 
@@ -718,6 +719,7 @@ static struct attribute *mmc_std_attrs[] = {
 	&dev_attr_enhanced_area_size.attr,
 	&dev_attr_raw_rpmb_size_mult.attr,
 	&dev_attr_rel_sectors.attr,
+	&dev_attr_dev_hierarchy.attr,
 	NULL,
 };
 
diff --git a/include/linux/mmc/dev.h b/include/linux/mmc/dev.h
new file mode 100644
index 0000000..8293126
--- /dev/null
+++ b/include/linux/mmc/dev.h
@@ -0,0 +1,9 @@
+#ifndef _DEV_H_
+#define _DEV_H_
+
+#include <linux/device.h>
+
+extern struct device_attribute dev_attr_dev_hierarchy;
+
+#endif
+
-- 
1.9.1

